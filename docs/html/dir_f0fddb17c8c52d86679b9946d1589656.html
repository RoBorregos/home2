<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Roborregos @Home documentation: /home/deivideich/roborregos/home_ws/src/home2/manipulation/packages/xarm_ros2/xarm_api Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Roborregos @Home documentation<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">Class documentation for the Roborregos @Home project</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('dir_f0fddb17c8c52d86679b9946d1589656.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">xarm_api Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-subdirs" class="groupheader"><a id="subdirs" name="subdirs"></a>
Directories</h2></td></tr>
<tr class="memitem:include" id="r_include"><td class="memItemLeft" align="right" valign="top"><span class="iconfolder"><div class="folder-icon"></div></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_bab83f892c91011d59f4315fd6e8527f.html">include</a></td></tr>
<tr class="memitem:launch" id="r_launch"><td class="memItemLeft" align="right" valign="top"><span class="iconfolder"><div class="folder-icon"></div></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_1123efc653e3e1db883a0e0d2f16b6f9.html">launch</a></td></tr>
<tr class="memitem:src" id="r_src"><td class="memItemLeft" align="right" valign="top"><span class="iconfolder"><div class="folder-icon"></div></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_f797253b1f0ba4d270768bd5bc18f9e6.html">src</a></td></tr>
<tr class="memitem:test" id="r_test"><td class="memItemLeft" align="right" valign="top"><span class="iconfolder"><div class="folder-icon"></div></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_53dea8e9ad907fe38e5351a8fface813.html">test</a></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<h1 class="doxsection"><a class="anchor" id="autotoc_md284"></a>
xarm_api/xarm_msgs:</h1>
<p>&ensp;&ensp;These two packages provide user with the ros2 service wrapper of the functions in Ufactory SDK. There are various types of motion command (service names) supportedï¼Œplease set correct robot mode first, refer to <a href="https://docs.ufactory.cc/support_articles/faq/robot-state-and-mode-explanation">this documentation</a> for the Mode/State definitions in our system.</p>
<p>&ensp;&ensp;<b>Attention</b>: You need to <b>enable the corresponding services</b> in advance if they have not been activated by default in <span class="tt">config/xarm_params.yaml</span>. Or you can set the <span class="tt">debug</span> parameter as <span class="tt">true</span> to enable all services at once. <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md285"></a>
Robot Mode 0:</h2>
<ul>
<li>&lt;font color=blue&gt;&gt;set_servo_angle:</li>
</ul>
<p>&lt;/font&gt; joint space point to point command, given target joint angles, max joint velocity and acceleration. Service definition: <a href="../xarm_msgs/srv/MoveJoint.srv">xarm_msgs/srv/MoveJoint</a>. If specify <span class="tt">wait=false</span> and proper <span class="tt">radius</span>, motion can be continuous with next motion with Arc blending at the via points, and velocity is also continuous. <br  />
</p>
<ul>
<li>&lt;font color=blue&gt;&gt;set_position:</li>
</ul>
<p>&lt;/font&gt; straight-line motion to the specified Cartesian Tool Centre Point(TCP) target. Service definition: <a href="../xarm_msgs/srv/MoveCartesian.srv">xarm_msgs/srv/MoveCartesian</a>. If specify <span class="tt">wait=false</span> and proper <span class="tt">radius</span>, motion can be continuous with next motion with Arc blending at the via points, and velocity is also continuous. Relative (delta) motion can also be achieved by setting <span class="tt">relative=true</span>. <br  />
</p>
<ul>
<li>&lt;font color=blue&gt;&gt;set_tool_position:</li>
</ul>
<p>&lt;/font&gt; straight-line motion, given target is expressed in <b>TOOL</b> coordinate system, can be considered as a relative motion. <br  />
</p>
<ul>
<li>&lt;font color=blue&gt;&gt;set_position_aa:</li>
</ul>
<p>&lt;/font&gt; straight-line motion, with orientation expressed in <b>Axis-angle</b> rather than roll-pitch-yaw angles. Please refer to xArm user manual for detailed explanation of axis-angle before using this command. <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md286"></a>
Robot Mode 1:</h2>
<ul>
<li>&lt;font color=blue&gt;&gt;set_servo_cartesian/set_servo_cartesian_aa/set_servo_angle_j:</li>
</ul>
<p>&lt;/font&gt; streamed high-frequency <span class="tt">[suggestion: 100 ~ 250Hz fixed]</span> trajectory command execution in Cartesian space or joint space, this mode is especially useful for external trajectory planner which generates time parameterized servo command (e.g. Moveit+ros-controllers) or sensor guided motion. Special <b>RISK ASSESMENT</b> is required before using them and please note there is no further interpolation and speed control in this mode. <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md287"></a>
Robot Mode 4:</h2>
<ul>
<li>&lt;font color=blue&gt;&gt;vc_set_joint_velocity:</li>
</ul>
<p>&lt;/font&gt; Joint motion with specified velocity for each joint (unit: rad/s), with maximum joint acceleration configurable by <span class="tt">set_joint_maxacc</span> service. <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md288"></a>
Robot Mode 5:</h2>
<ul>
<li>&lt;font color=blue&gt;&gt;vc_set_cartesian_velocity:</li>
</ul>
<p>&lt;/font&gt; Linear motion of TCP with specified velocity in mm/s (position) and rad/s (orientation in <b>axis-angular_velocity</b>), with maximum linear acceleration configurable by <span class="tt">set_tcp_maxacc</span> service. <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md289"></a>
Robot Mode 6: (Firmware &gt;= v1.10.0)</h2>
<ul>
<li>&lt;font color=blue&gt;&gt;set_servo_angle:</li>
</ul>
<p>&lt;/font&gt; Online joint space replanning to the new joint angles, with new max joint velocity and acceleration. Joint velocities and accelerations are continuous during transition, however the velocity profiles may not be synchronous and the final reached positions may have small errors. <b>This function is mainly for dynamic response without self trajectory planning requirement like servo joint commands</b>. <span class="tt">wait</span> parameter has to be <span class="tt">false</span> for successful transition.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md290"></a>
Robot Mode 7: (Firmware &gt;= v1.11.0)</h2>
<ul>
<li>&lt;font color=blue&gt;&gt;set_position/set_position_aa:</li>
</ul>
<p>&lt;/font&gt; Online Cartesian space replanning to the new target coordinate, with new max linear velocity and acceleration. Velocities and accelerations are continuous during transition, <b>This function is mainly for dynamic response without self trajectory planning requirement like servo cartesian commands</b>. <span class="tt">wait</span> parameter has to be <span class="tt">false</span> for successful transition. <br  />
</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md291"></a>
1. Starting xArm by ROS service:</h1>
<p>&ensp;&ensp;First startup the service server for xarm7, ip address is just an example: <br  />
 </p><div class="fragment"><div class="line">$ ros2 launch xarm_api xarm7_driver.launch.py robot_ip:=192.168.1.127 report_type:=normal</div>
</div><!-- fragment --><p> The argument <span class="tt">report_type</span> is explained here. <br  />
</p>
<p>&ensp;&ensp;Then make sure all the servo motors are enabled: </p><div class="fragment"><div class="line">$ ros2 service call /xarm/motion_enable xarm_msgs/srv/SetInt16ById &quot;{id: 8, data: 1}&quot;</div>
</div><!-- fragment --><p> &ensp;&ensp;Before any motion commands, set proper robot mode(0: POSE, as example) and state(0: READY) <em><b>in order</b></em>: <br  />
 </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_mode xarm_msgs/srv/SetInt16 &quot;{data: 0}&quot;</div>
<div class="line">$ ros2 service call /xarm/set_state xarm_msgs/srv/SetInt16 &quot;{data: 0}&quot;</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md292"></a>
2. Joint or Cartesian space command example [use firmware planner]:</h1>
<p>&ensp;&ensp;This section will talk about general motion service interface, with firmware assisted planner for speed/acceleration control and smooth trajectory generation. Please note that all the angles for service command must use the unit of <em><b>radian</b></em>. <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md293"></a>
2.1 Joint space motion:</h2>
<p>&ensp;&ensp; To call joint space (7DOF) motion with max speed 0.35 rad/s and acceleration 10 rad/s^2: <br  />
 </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_servo_angle xarm_msgs/srv/MoveJoint &quot;{angles: [-0.28, 0, 0, 0, 0, 0, 0], speed: 0.35, acc: 10}&quot;</div>
</div><!-- fragment --><p> Note: This command is valid for both <b>Mode 0</b> and <b>mode 6</b>. The difference is: In mode 0 each received command will be <b>queued</b> and executed fully in order, whereas in mode 6(must specify <span class="tt">wait</span> as <span class="tt">false</span>), the newly received target will take effect immediately and all previous commands will be <b>discarded</b>. <br  />
</p>
<p>&ensp;&ensp;To go back to home (all joints at 0 rad) position with max speed 0.35 rad/s and acceleration 10 rad/s^2: <br  />
 </p><div class="fragment"><div class="line">$ ros2 service call /xarm/move_gohome xarm_msgs/srv/MoveHome &quot;{speed: 0.35, acc: 10}&quot;</div>
</div><!-- fragment --> <h2 class="doxsection"><a class="anchor" id="autotoc_md294"></a>
2.2 Cartesian space motion in Base coordinate:</h2>
<p>&ensp;&ensp;To call Cartesian motion to the target expressed in robot BASE Coordinate, with max speed 200 mm/s and acceleration 2000 mm/s^2: </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_position xarm_msgs/srv/MoveCartesian &quot;{pose: [300, 0, 250, 3.14, 0, 0], speed: 200, acc: 2000}&quot;</div>
</div><!-- fragment --><p> Note: This command is valid for both <b>Mode 0</b> and <b>mode 7</b>. The difference is: In mode 0 each received command will be <b>queued</b> and executed fully in order, whereas in mode 7(must specify <span class="tt">wait</span> as <span class="tt">false</span>), the newly received target will take effect immediately and all previous commands will be <b>discarded</b>. <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md295"></a>
2.3 Cartesian space motion in Tool coordinate:</h2>
<p>&ensp;&ensp;To execute Cartesian motion expressed in robot TOOL Coordinate, with max speed 50 mm/s and acceleration 1000 mm/s^2, the following will move a <b>relative motion</b> (delta_x=50mm, delta_y=100mm, delta_z=100mm) along the current Tool coordinate, no orientation change: </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_tool_position xarm_msgs/srv/MoveCartesian &quot;{pose: [50, 100, 100, 0, 0, 0], speed: 50, acc: 1000}&quot;</div>
</div><!-- fragment --> <h2 class="doxsection"><a class="anchor" id="autotoc_md296"></a>
2.4 Cartesian space motion in Axis-angle orientation:</h2>
<p>&ensp;&ensp;Please pay attention to two special arguments: "**is_tool_coord**" is <span class="tt">false</span> for motion with respect to (w.r.t.) Arm base coordinate system, and <span class="tt">true</span> for motion w.r.t. Tool coordinate system. "**relative**" is <span class="tt">false</span> for absolute target position w.r.t. specified coordinate system, and <span class="tt">true</span> for relative target position. <br  />
 &ensp;&ensp;For example: to move 1.0 radian relatively around tool-frame Z-axis: </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_position_aa xarm_msgs/srv/MoveCartesian &quot;{pose: [0, 0, 0, 0, 0, 1.0], speed: 50, acc: 1000, is_tool_coord: true}&quot;</div>
</div><!-- fragment --><p> &ensp;&ensp;"**mvtime**" is not meaningful in this command, just set it to 0. Another example: in base-frame, to move 122mm relatively along Y-axis, and rotate around X-axis for -0.5 radians: <br  />
 </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_position_aa xarm_msgs/srv/MoveCartesian &quot;{pose: [0, 122, 0, -0.5, 0, 0], speed: 100, acc: 1000, is_tool_coord: false, relative: true}&quot;  </div>
</div><!-- fragment --> <h2 class="doxsection"><a class="anchor" id="autotoc_md297"></a>
2.5 Joint velocity control:</h2>
<p>&ensp;&ensp;(<b>xArm controller firmware version &gt;= 1.6.8</b> required) If controlling joint velocity is desired, first switch to <b>Mode 4</b> as descriped in <a href="https://docs.ufactory.cc/support_articles/faq/robot-state-and-mode-explanation">mode explanation</a>. Please check the <a href="../xarm_msgs/srv/MoveVelocity.srv">MoveVelocity.srv</a> first to understand the meanings of parameters reqired. If more than one joint are to move, set <b>is_sync</b> to <span class="tt">true</span> for synchronized acceleration/deceleration for all joints in motion, and if is_sync is <span class="tt">false</span>, each joint will reach to its target velocity as fast as possible. <em><b>is_tool_coord</b></em> parameter is not used here. For example: </p><div class="fragment"><div class="line"># NO Timed-out version (will not stop until all-zero velocity command received!):</div>
<div class="line">$ ros2 service call /xarm/vc_set_joint_velocity xarm_msgs/srv/MoveVelocity &quot;{speeds: [-0.1, 0, 0, 0, 0, 0, 0.2], is_sync: true}&quot;</div>
<div class="line"># With Timed-out version(controller firmware version &gt;= 1.8.0): (if next velocity command not received within 0.2 seconds, xArm will stop)  </div>
<div class="line">$ ros2 service call /xarm/vc_set_joint_velocity xarm_msgs/srv/MoveVelocity &quot;{speeds: [-0.1, 0, 0, 0, 0, 0, 0.2], is_sync: true, duration: 0.2}&quot;</div>
</div><!-- fragment --><p> will command the joints (for xArm7) to move in specified angular velocities (in rad/s) and they will reach to target velocities synchronously. The maximum joint acceleration can also be configured by (unit: rad/s^2): <br  />
 </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_joint_maxacc xarm_msgs/srv/SetFloat32 &quot;{data: 10.0}&quot;  (maximum: 20.0 rad/s^2)</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md298"></a>
2.6 Cartesian velocity control:</h2>
<p>&ensp;&ensp;(<b>xArm controller firmware version &gt;= 1.6.8</b> required) If controlling linar velocity of TCP towards certain direction is desired, first switch to <b>Mode 5</b> as descriped in <a href="https://docs.ufactory.cc/support_articles/faq/robot-state-and-mode-explanation">mode explanation</a>. Please check the <a href="../xarm_msgs/srv/MoveVelocity.srv">MoveVelocity.srv</a> first to understand the meanings of parameters reqired. Set <b>is_tool_coord</b> to <span class="tt">false</span> for motion in world/base coordinate system and <span class="tt">true</span> for tool coordinate system. <em><b>is_sync</b></em> parameter is not used here. For example: </p><div class="fragment"><div class="line"># NO Timed-out version (will not stop until all-zero velocity command received!):  </div>
<div class="line">$ ros2 service call /xarm/vc_set_cartesian_velocity xarm_msgs/srv/MoveVelocity &quot;{speeds: [30, 0, 0, 0, 0, 0.1], is_tool_coord: true}&quot;  </div>
<div class="line"># With Timed-out version(controller firmware version &gt;= 1.8.0): (if next velocity command not received within 0.5 seconds, xArm will stop)  </div>
<div class="line">$ ros2 service call /xarm/vc_set_cartesian_velocity xarm_msgs/srv/MoveVelocity &quot;{speeds: [30, 0, 0, 0, 0, 0.1], is_tool_coord: true, duration: 0.5}&quot;</div>
</div><!-- fragment --><p> will command xArm TCP move along X-axis of TOOL coordinate system with speed of 30 mm/s and rotate around Z axis at 0.1 rad/s. The maximum linear acceleration can also be configured by (unit: mm/s^2): <br  />
 </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_tcp_maxacc xarm_msgs/srv/SetFloat32 &quot;{data: 2500}&quot; (maximum: 50000 mm/s^2)</div>
</div><!-- fragment --><p>For angular motion in orientation, please note the velocity is specified as <b>axis-angular_velocity</b> elements. That is, [the unit rotation axis vector] multiplied by [rotation velocity value(scalar)]. For example, </p><div class="fragment"><div class="line"># NO Timed-out version (will not stop until all-zero velocity command received!):</div>
<div class="line">$ ros2 service call /xarm/vc_set_cartesian_velocity xarm_msgs/srv/MoveVelocity &quot;{speeds: [0, 0, 0, 0.707, 0, 0], is_tool_coord: false}&quot;</div>
<div class="line"># With Timed-out version(controller firmware version &gt;= 1.8.0): (if next velocity command not received within 0.2 seconds, xArm will stop)  </div>
<div class="line">$ ros2 service call /xarm/vc_set_cartesian_velocity xarm_msgs/srv/MoveVelocity &quot;{speeds: [0, 0, 0, 0.707, 0, 0], is_tool_coord: false, duration: 0.2}&quot;</div>
</div><!-- fragment --><p> This will command TCP to rotate along X-axis in BASE coordinates at about 45 degrees/sec. The maximum acceleration for orientation change is fixed. <br  />
</p>
<p>Please Note: For no Timed-out version services: velocity motion can be stopped by either giving <b>all 0 velocity</b> command, or setting <b>state to 4(STOP)</b> and 0(READY) later for next motion. However, <b>timed-out versions are more recommended for use</b>, since it can be safe if network comminication or user program fails, controller firmware needs to be updated to v1.8.0 or later. <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md299"></a>
2.7 Motion service Return:</h2>
<p>&ensp;&ensp;Please Note the above motion services will <b>return immediately</b> if <span class="tt">wait</span> parameter is set to <span class="tt">false</span>. If you wish to return until actual motion is finished, please set it to be <span class="tt">true</span>. <br  />
 &ensp;&ensp;Upon sending success, 0 will be returned. If any error occurs, other values will be returned.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md300"></a>
3. Joint or Cartesian space servo command [quick step execution]:</h1>
<p>&ensp;&ensp;This section will talk about the servo (<span class="tt">realtime, updated at high-frequency</span>) command interface, only effective in <b>Mode 1</b>. Please note that all the angles for service command must use the unit of <em><b>radian</b></em>. <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md301"></a>
3.1 Cartesian space servoing:</h2>
<p><b>PLEASE NOTE:</b> If you are already using <b>Moveit</b> to control the real robot arm, move_servoj and move_servo_cart <b>can not be used concurrently</b>, since they use the same mode(1) to control and may interfere with each other! <br  />
</p>
<p>Now with xArm controller <b>Firmware Version &gt;= 1.4.1</b>, user can send streamed Cartesian poses to continuously control the xArm, through ros service, this is a wrap of the same xarm sdk(api) function. The actual speed depends on the sending frequency and step distance. Users are encouraged to send the path points in a fixed frequency(100Hz~250Hz) and step distance(<b>MUST</b> &lt;10mm). <br  />
</p>
<p>(1) To start, bring up the xarm server and in another terminal, do initial configurations, servo cartesian has to operate in <b>Mode 1</b>:</p>
<p>(2) Call the servo_cartesian service. Please note: <br  />
 <b>(1) the Cartesian pose representation is the same with xarm SDK here. which is [<a class="el" href="add__primitives_8cpp.html#a6c377378d852c5841ed836dad1071a59a02129bb861061d1a052c592e2dc6b383">X(mm)</a>, <a class="el" href="add__primitives_8cpp.html#a6c377378d852c5841ed836dad1071a59a57cec4137b614c87cb4e24a3d003a3e0">Y(mm)</a>, <a class="el" href="add__primitives_8cpp.html#a6c377378d852c5841ed836dad1071a59a21c2e59531c8710156d34a3c30ac81d5">Z(mm)</a>, Roll(rad), Pitch(rad), Yaw(rad)]</b> <br  />
 <b>(2) the path must start from current tool center point(TCP) position and the command can not be too far away, or the execution will fail or act strange. PLEASE CHECK the correctness of command before sending it.</b> <br  />
 <b>(3) For servo motion, the arguments mvvelo, mvacc, mvtime, and mvradii are not effective now, so just give them all 0.</b> <br  />
</p>
<p>Suppose current TCP position is at [206, 0, 121, 3.1416, 0, 0] </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_servo_cartesian xarm_msgs/srv/MoveCartesian &quot;{pose: [208, 0, 121, 3.1416, 0, 0]}&quot;</div>
</div><!-- fragment --><p> Now please check the current TCP position, it will execute this target immediately if success. If you want continuous motion alone X axis, you can give the following pose like: </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_servo_cartesian xarm_msgs/srv/MoveCartesian &quot;{pose: [210, 0, 121, 3.1416, 0, 0]}&quot;</div>
</div><!-- fragment --><p> And you can program this service calling procedure in a loop with proper intervals inbetween, the final execution will become smooth. <br  />
</p>
<p><b>Notice: Servo_cartisian in TOOL coordinate:</b> Please update the controller Firmware to version &gt;= 1.5.0. If servo_cartesian in Tool Coordinate is needed, <b>set "is_tool_coord" to be true</b>, the resulted motion will base on current Tool coordinate. For example: <br  />
 </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_servo_cartesian xarm_msgs/srv/MoveCartesian &quot;{pose: [0, 0, 2, 0, 0, 0], is_tool_coord: true}&quot;</div>
</div><!-- fragment --><p> This will make TCP to move 2 mm immediately along +Z Axis in <b>TOOL Coordinate</b>. You may also use <span class="tt">xarm/set_servo_cartesian_aa</span> service for axis-angle expression command. <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md302"></a>
3.2 Joint space servoing:</h2>
<p>There is also a similar service called "**/xarm/set_servo_angle_j**", you can use this service to control joint motion in the <b>same mode (1)</b> with Servo_Cartesian. It receives <b>absolute</b> joint positions as command. Before calling it, please check the current joint position in "/xarm/joint_states" topic, and increase the target joint position <b>little by little</b> just like calling /xarm/set_servo_cartesian.</p>
<p>For example, if /xarm/joint_state says current joint positions are: [0.25,-0.47,0.0,-0.28,0.0,0.76,0.24], you can call: <br  />
 </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_servo_angle_j xarm_msgs/srv/MoveJoint &quot;{angles: [0.25,-0.47,0.0,-0.28,0.0,0.76,0.25]}&quot;</div>
</div><!-- fragment --><p> Which will move joint7 by 0.01 rad <b>immediately</b>. Keep calling it and increase the joint positions a small step each time, it will move smoothly. <b>Be careful not to give a target too far away in one single update</b>. <br  />
</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md303"></a>
4. Tool I/O Operations:</h1>
<p>&ensp;&ensp;We provide 2 digital, 2 analog input port and 2 digital output signals at the end I/O connector. <br  />
 </p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md304"></a>
4.1 To get current 2 DIGITAL input states:</h2>
<div class="fragment"><div class="line">$ ros2 service call /xarm/get_tgpio_digital xarm_msgs/srv/GetDigitalIO </div>
</div><!-- fragment --> <h2 class="doxsection"><a class="anchor" id="autotoc_md305"></a>
4.2 To get one of the ANALOG input value:</h2>
<div class="fragment"><div class="line">$ ros2 service call /xarm/get_tgpio_analog xarm_msgs/srv/GetAnalogIO &quot;{ionum: 0}&quot;  (io number, can only be 0 or 1)</div>
</div><!-- fragment --> <h2 class="doxsection"><a class="anchor" id="autotoc_md306"></a>
4.3 To set one of the Digital output:</h2>
<div class="fragment"><div class="line">$ ros2 service call /xarm/set_tgpio_digital xarm_msgs/srv/SetDigitalIO &quot;{ionum: 0, value: 1}&quot;  (Setting output port 0 to be 1)</div>
</div><!-- fragment --><p> &ensp;&ensp;You have to make sure the operation is successful by checking responding "ret" to be 0.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md307"></a>
5. Controller I/O Operations:</h1>
<p>&ensp;&ensp;We provide 8/16 digital input and 8/16 digital output ports at controller box for general usage. <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md308"></a>
5.1 To get all of the controller DIGITAL input state:</h2>
<div class="fragment"><div class="line">$ ros2 service call /xarm/get_cgpio_digital xarm_msgs/srv/GetDigitalIO  # (Notice: from 1st to 8th, for CO0~CO7; from 9th to 16th, for DI0~DI7[if any])</div>
</div><!-- fragment --> <h2 class="doxsection"><a class="anchor" id="autotoc_md309"></a>
5.2 To set one of the controller DIGITAL output:</h2>
<div class="fragment"><div class="line">$ ros2 service call /xarm/set_cgpio_digital xarm_msgs/srv/SetDigitalIO &quot;{ionum: 0, value: 1}&quot; </div>
</div><!-- fragment --><p> &ensp;&ensp;Please note port number starts from 0, for example: <br  />
 </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_cgpio_digital xarm_msgs/srv/SetDigitalIO &quot;{ionum: 4, value: 1}&quot;   #(Setting 5th [lable C04] output port to be 1)</div>
</div><!-- fragment --> <h2 class="doxsection"><a class="anchor" id="autotoc_md310"></a>
5.3 To get one of the controller ANALOG input:</h2>
<div class="fragment"><div class="line">$ ros2 service call /xarm/get_cgpio_analog xarm_msgs/srv/GetAnalogIO &quot;{ionum: &lt;port_num&gt;}&quot;  # ionum: 0 or 1</div>
</div><!-- fragment --> <h2 class="doxsection"><a class="anchor" id="autotoc_md311"></a>
5.4 To set one of the controller ANALOG output:</h2>
<div class="fragment"><div class="line">$ ros2 service call /xarm/set_cgpio_analog xarm_msgs/srv/SetAnalogIO  &quot;{ionum: &lt;port_num&gt;, value: &lt;target_value&gt;}&quot;</div>
</div><!-- fragment --><p> &ensp;&ensp;For example: <br  />
 </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_cgpio_analog xarm_msgs/srv/SetAnalogIO  &quot;{ionum: 1, value: 3.3}&quot;  #(Setting port AO1 to be 3.3)</div>
</div><!-- fragment --><p> &ensp;&ensp;You have to make sure the operation is successful by checking responding "ret" to be 0.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md312"></a>
6. Getting status feedback:</h1>
<p>&ensp;&ensp;Having connected with a real xArm robot by running '<a class="el" href="xarm7__driver_8launch_8py.html">xarm7_driver.launch.py</a>', user can subscribe to the topic <em><b>"xarm/robot_states"</b></em> for feedback information about current robot states, including joint angles, TCP position, error/warning code, etc. Refer to <a href="../xarm_msgs/msg/RobotMsg.msg">RobotMsg.msg</a> for content details. <br  />
 &ensp;&ensp;Another option is subscribing to <em><b>"xarm/joint_states"</b></em> topic, which is reporting in <a href="http://docs.ros.org/jade/api/sensor_msgs/html/msg/JointState.html">JointState.msg</a>, however, currently <em><b>only "position" field data is solidly valid</b></em>; "velocity" is non-filtered numerical differentiation based on 2 adjacent position data, and "effort" feedback are current-based estimated values, not from direct torque sensor, so they are just for reference. &ensp;&ensp;In consideration of performance, default update rate of above two topics are set at <em><b>5Hz</b></em>. The report content and frequency have other options, refer to report_type argument <br  />
</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md313"></a>
7. Clearing Errors:</h1>
<p>&ensp;&ensp;Sometimes controller may report error or warnings that would affect execution of further commands. The reasons may be power loss, position/speed limit violation, planning errors, etc. It needs additional intervention to clear. User can check error code ("err" field) in the message of topic <em><b>"xarm/robot_states"</b></em> . </p><div class="fragment"><div class="line">$ ros2 topic echo /xarm/robot_states</div>
</div><!-- fragment --><p> &ensp;&ensp;If it is non-zero, the corresponding reason can be found out in the user manual. After solving the problem, this error satus can be removed by calling service <em><b>"/xarm/clean_error"</b></em> with empty argument. </p><div class="fragment"><div class="line">$ ros2 service call /xarm/clean_error xarm_msgs/srv/Call</div>
</div><!-- fragment --><p> &ensp;&ensp;After calling <span class="tt">clean_error</span> service, please <em><b>check the err status again</b></em> in 'xarm/robot_states', if it becomes 0, the clearing is successful. Otherwise, it means the error/exception is not properly solved. If using Moveit!, please set mode to 1 again manually, since controller error and state 4 will automatically switch mode back to 0. If clearing error is successful, remember to <em><b>set robot state to 0</b></em> to make it ready to move again! <br  />
</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md314"></a>
8. Gripper Control:</h1>
<p>&ensp;&ensp; If our Gripper (from UFACTORY) is attached to the tool end, the following services/actions can be called to operate or check the gripper. Please note we now have three types of grippers, judging from the service name: the ones with "bio_gripper" are for BIO parallel gripper, "lite_gripper" ones are for small gripper of lite 6, and the rest with just "gripper" are for xArm gripper. We will just use xArm gripper for instructions. <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md315"></a>
8.1 Gripper services:</h2>
<p>(1) Upon powering up, first enable the griper and configure the grasp speed: <br  />
 </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_gripper_enable xarm_msgs/srv/SetInt16 &quot;{data: 1}&quot;</div>
<div class="line">$ ros2 service call /xarm/set_gripper_mode xarm_msgs/srv/SetInt16 &quot;{data: 0}&quot;</div>
<div class="line">$ ros2 service call /xarm/set_gripper_speed xarm_msgs/srv/SetFloat32 &quot;{data: 1500}&quot;</div>
</div><!-- fragment --><p> &ensp;&ensp; Proper range of the speed is <em><b>from 1 to 5000</b></em>. 1500 is used as an example. 'ret' value is 0 for success. <br  />
 (2) Give position command (open distance) to xArm gripper: <br  />
 </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_gripper_position xarm_msgs/srv/GripperMove &quot;{pos: 500}&quot;</div>
</div><!-- fragment --><p> &ensp;&ensp; Proper range of the open distance is <em><b>from 0 to 850</b></em>. 0 is closed, 850 is fully open. 500 is used as an example. 'ret' value is 0 for success. <br  />
</p>
<p>(3) To get the current status (position and error_code) of xArm gripper: </p><div class="fragment"><div class="line">$ ros2 service call /xarm/get_gripper_position xarm_msgs/srv/GetFloat32</div>
<div class="line">$ ros2 service call /xarm/get_gripper_err_code xarm_msgs/srv/GetInt16</div>
</div><!-- fragment --><p> &ensp;&ensp; If error code is non-zero, please refer to user manual for the cause of error, the "/xarm/clear_err" service can still be used to clear the error code of xArm Gripper. <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md316"></a>
8.2 Gripper action:</h2>
<p>&ensp;&ensp; The xArm gripper move action is <span class="tt">xarm_gripper/gripper_action</span>, which is of type <span class="tt">control_msgs/action/GripperCommand</span>. <b>Attention:</b> The goal position here should be the rotation angle of the virtual joint inside, which is <b>from 0 rad (fully open) to 0.86 (fully closed)</b>. Not the pulse in afore-mentioned service call. Gripper action can be called by: <br  />
 </p><div class="fragment"><div class="line">$ ros2 action send_goal /xarm_gripper/gripper_action control_msgs/action/GripperCommand &quot;{command: {position: 0.5, max_effort: 0}}&quot;</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md317"></a>
9. Vacuum Gripper Control:</h1>
<p>&ensp;&ensp; If Vacuum Gripper (from UFACTORY) is attached to the tool end, the following service can be called to operate the vacuum gripper. Note the command service is applicable for both xArm and lite vacuum grippers. <br  />
</p>
<p>&ensp;&ensp;To turn on: <br  />
 </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_vacuum_gripper xarm_msgs/srv/VacuumGripperCtrl &quot;{&#39;on&#39;: true}&quot;</div>
</div><!-- fragment --><p> &ensp;&ensp;To turn off: <br  />
 </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_vacuum_gripper xarm_msgs/srv/VacuumGripperCtrl &quot;{&#39;on&#39;: false}&quot;</div>
</div><!-- fragment --><p> &ensp;&ensp;0 will be returned upon successful execution. <br  />
</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md318"></a>
10. Tool Modbus communication:</h1>
<p>If modbus communication with the tool device is needed, please first set the proper baud rate and timeout parameters through the relevant services: </p><div class="fragment"><div class="line">$ ros2 service call /xarm/set_tgpio_modbus_baudrate xarm_msgs/srv/SetInt32 &quot;{data: 115200}&quot;</div>
<div class="line">$ ros2 service call /xarm/set_tgpio_modbus_timeout xarm_msgs/srv/SetModbusTimeout &quot;{timeout: 20}&quot;  # unit: ms</div>
</div><!-- fragment --><p> The above command will configure the tool modbus baudrate to be 115200 bps and timeout threshold to be 20 <b>ms</b>. It is not necessary to configure again if these properties are not changed afterwards. Currently, only the following baud rates (bps) are supported: [4800, 9600, 19200, 38400, 57600, 115200, 230400, 460800, 921600, 1000000, 1500000, 2000000, 2500000]. <br  />
</p>
<p>Then the communication can be conducted like (refer to <a href="../xarm_msgs/srv/GetSetModbusData.srv">GetSetModbusData.srv</a> for more parameter details): <br  />
 </p><div class="fragment"><div class="line">$ ros2 service call /xarm/getset_tgpio_modbus_data xarm_msgs/srv/GetSetModbusData &quot;{modbus_data: [0x01,0x06,0x00,0x0A,0x00,0x03]}&quot;</div>
</div><!-- fragment --><p> please check the <span class="tt">ret_data</span> field for device response data. <br  />
</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md319"></a>
11. "report_type" argument:</h1>
<p>When launching real xArm ROS2 applications, the argument "report_type" can be specified. It decides the state feedback rate and content. Refer to the <a href="https://www.ufactory.cc/_files/ugd/896670_1f106918b523404284c6916de025cf28.pdf">developer manual</a> at chapter <b>2.1.6 Automatic Reporting Format</b> for the report contents of the three available report type (<span class="tt">normal/rich/dev</span>), default type using is "normal". <br  />
</p>
<ul>
<li>For users who demand high-frequency feedback, <span class="tt">report_type:=dev</span> can be specified, then the topics <span class="tt">xarm/robot_states</span> and <span class="tt">xarm/joint_states</span> will be published at <b>100Hz</b>. <br  />
</li>
<li>For users who want the controller gpio states being updated at <span class="tt">xarm/xarm_cgpio_states</span> topic, please use <span class="tt">report_type:=rich</span>, since this reports the fullest information from the controller. As can be seen in developer manual. <br  />
</li>
<li>The report rate of the three types:</li>
</ul>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">type  </th><th class="markdownTableHeadCenter">port No.  </th><th class="markdownTableHeadCenter">Frequency  </th><th class="markdownTableHeadCenter">GPIO topic  </th><th class="markdownTableHeadCenter">F/T sensor topic  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">normal  </td><td class="markdownTableBodyCenter">30001  </td><td class="markdownTableBodyCenter">5Hz  </td><td class="markdownTableBodyCenter">Not Available  </td><td class="markdownTableBodyCenter">Not Available  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">rich  </td><td class="markdownTableBodyCenter">30002  </td><td class="markdownTableBodyCenter">5Hz  </td><td class="markdownTableBodyCenter">Available  </td><td class="markdownTableBodyCenter">Available  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">dev  </td><td class="markdownTableBodyCenter">30003  </td><td class="markdownTableBodyCenter">100Hz  </td><td class="markdownTableBodyCenter">Not Available  </td><td class="markdownTableBodyCenter">Available  </td></tr>
</table>
<p>Note: <b>GPIO topic</b> =&gt; <span class="tt">xarm/xarm_cgpio_states</span>. <b>F/T sensor topic</b> =&gt; <span class="tt">xarm/uf_ftsensor_ext_states</span> and <span class="tt">xarm/uf_ftsensor_raw_states</span>. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_2d3b31f5269641a65ad69fd5e63e7c5f.html">manipulation</a></li><li class="navelem"><a href="dir_7789cadc33ffb2720130327e1e043559.html">packages</a></li><li class="navelem"><a href="dir_8a225a6405453e8db1c9c4c5541f862c.html">xarm_ros2</a></li><li class="navelem"><a href="dir_f0fddb17c8c52d86679b9946d1589656.html">xarm_api</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
